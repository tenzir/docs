---
import Default from '@astrojs/starlight/components/PageFrame.astro';
import TenzirFooter from './TenzirFooter.astro';

const { hasSidebar } = Astro.locals.starlightRoute;
---

<script is:inline>
  /**
   * Add Starlight-style anchor links to headings that don't have them.
   * This handles headings from MDX components/partials.
   */
  function addHeadingAnchors() {
    const headings = document.querySelectorAll(
      "h2[id], h3[id], h4[id], h5[id], h6[id]"
    );

    headings.forEach((heading) => {
      const parent = heading.parentElement;
      if (parent?.classList.contains("sl-heading-wrapper")) return;

      const id = heading.id;
      const level = heading.tagName.toLowerCase().charAt(1);

      const anchorLink = document.createElement("a");
      anchorLink.className = "sl-anchor-link";
      anchorLink.href = `#${id}`;
      anchorLink.innerHTML = `
        <span aria-hidden="true" class="sl-anchor-icon">
          <svg width="16" height="16" viewBox="0 0 24 24">
            <path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path>
          </svg>
        </span>
        <span class="sr-only">Section titled "${id}"</span>
      `;

      const wrapper = document.createElement("div");
      wrapper.className = `sl-heading-wrapper level-h${level}`;
      heading.parentNode?.insertBefore(wrapper, heading);
      wrapper.appendChild(heading);
      wrapper.appendChild(anchorLink);
    });
  }

  document.addEventListener("DOMContentLoaded", addHeadingAnchors);
  document.addEventListener("astro:page-load", addHeadingAnchors);
</script>

<div class="layout-wrapper">
  <div class="main-layout">
    <Default {...Astro.props}>
      <slot name="header" slot="header" />
      <slot name="sidebar" slot="sidebar" />
      <slot />
    </Default>
  </div>
  <div class="footer-wrapper" data-has-sidebar={hasSidebar}>
    <TenzirFooter />
  </div>
</div>

<style>
  .layout-wrapper {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .main-layout {
    flex: 1;
  }
  
  .footer-wrapper {
    width: 100%;
  }
  
  /* On larger screens with sidebar, offset footer to start after sidebar */
  @media (min-width: 50em) {
    .footer-wrapper[data-has-sidebar="true"] {
      margin-left: var(--sl-sidebar-width);
      width: calc(100% - var(--sl-sidebar-width));
    }
  }
</style>
