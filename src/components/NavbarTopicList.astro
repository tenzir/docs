---
import { pathWithBase } from '../utils/base';
import {
  topicParents,
  rootTopics,
  childTopics,
} from '../topics.ts';

const { topics: sidebarTopics } = Astro.locals.starlightSidebarTopics;

// Find the current topic
const currentTopic = sidebarTopics.find((topic) => topic.isCurrent);
if (!currentTopic) {
  console.warn('No current topic found â€” skipping topic-specific rendering');
}

// Build navbar topics: always show the root topics
const navbarTopics = rootTopics();

// Determine if a given topic is "current" or an ancestor of the current one
function isTopicCurrentOrAncestor(label) {
  if (!currentTopic) return false;
  if (label === currentTopic.label) return true;
  let cursor = currentTopic.label;
  while (cursor) {
    const parent = topicParents[cursor];
    if (parent === label) return true;
    cursor = parent;
  }
  return false;
}
---

{navbarTopics.length > 0 && (
  <nav>
    <ul>
      {
      navbarTopics.map((topic) => (
      <li>
        <a
          href={pathWithBase(topic.link)}
          aria-current={isTopicCurrentOrAncestor(topic.label) ? 'page' : undefined}
          >
          {topic.label}
        </a>
      </li>
      ))
      }
    </ul>
  </nav>
)}

<style>
  nav {
    display: flex;
    align-items: center;
    height: 100%;
  }

  ul {
    display: flex;
    align-items: center;
    list-style: none;
    padding: 0;
    margin: 0;
    gap: var(--tnz-space-1);
    height: 100%;
  }

  li {
    display: flex;
    align-items: center;
    height: 100%;
  }

  a {
    display: flex;
    align-items: center;
    height: 100%;
    text-decoration: none;
    color: var(--tnz-neutral-400);
    padding: 0 var(--tnz-space-2);
    font-size: var(--tnz-text-sm);
    font-weight: var(--tnz-font-medium);
    line-height: var(--tnz-leading-sm);
    transition: color var(--tnz-transition-base);
    position: relative;
    white-space: nowrap;
  }

  /* Bottom border indicator */
  a::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: var(--tnz-space-2);
    right: var(--tnz-space-2);
    height: 2px;
    background-color: transparent;
    transition: background-color var(--tnz-transition-base);
  }

  a:hover {
    color: var(--sl-color-white);
  }

  a:focus-visible {
    color: var(--sl-color-white);
    outline: none;
  }

  a:focus-visible::after {
    background-color: var(--tnz-neutral-400);
  }

  [aria-current="page"] {
    color: var(--sl-color-white);
  }

  [aria-current="page"]::after {
    background-color: var(--tnz-primary-500);
  }

  [aria-current="page"]:hover::after,
  [aria-current="page"]:focus-visible::after {
    background-color: var(--tnz-primary-500);
  }

  /* Light mode adjustments */
  :root[data-theme='light'] a {
    color: var(--tnz-neutral-500);
  }

  :root[data-theme='light'] a:hover,
  :root[data-theme='light'] a:focus-visible {
    color: var(--tnz-neutral-800);
  }

  :root[data-theme='light'] [aria-current="page"] {
    color: var(--tnz-neutral-800);
  }
</style>
