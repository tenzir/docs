---
export interface Props {
  imageSrc?: string;
  activeSection?: "tutorials" | "guides" | "explanations" | "reference" | null;
}

const { imageSrc = "/docs-structure.svg", activeSection = null } = Astro.props;

const sections = [
  {
    id: "tutorials",
    label: "Go to Tutorials",
    x: 30.253476805227137,
    y: 30,
    width: 340,
    height: 160,
  },
  {
    id: "guides",
    label: "Go to Guides",
    x: 490.25347680522714,
    y: 30,
    width: 340,
    height: 160,
  },
  {
    id: "explanations",
    label: "Go to Explanations",
    x: 30.357785625969427,
    y: 310.1043088207423,
    width: 340,
    height: 160,
  },
  {
    id: "reference",
    label: "Go to Reference",
    x: 490.25347680522714,
    y: 310,
    width: 340,
    height: 160,
  },
];

// Define which sections should be clickable based on the active section
const getClickableStatus = (section: string) => {
  return activeSection !== section;
};

// Get the appropriate href for each section
const getHref = (section: string) => {
  if (activeSection === section) return undefined;
  return `/${section}/`;
};
---

<div class="interactive-diagram-container">
  <svg
    class="diagram-svg"
    viewBox="0 0 859.7111327472201 500.19774685637094"
    role="img"
    aria-label="Documentation structure"
  >
    <image
      href={imageSrc}
      x="0"
      y="0"
      width="859.7111327472201"
      height="500.19774685637094"
      preserveAspectRatio="xMidYMid meet"
      class="diagram-image inline-svg"
    />
    {
      sections.map((section) => {
        const isClickable = getClickableStatus(section.id);
        const href = getHref(section.id);
        return isClickable ? (
          <a
            href={href}
            class="overlay-link"
            aria-label={section.label}
          >
            <rect
              class="overlay-rect"
              x={section.x}
              y={section.y}
              width={section.width}
              height={section.height}
              vector-effect="non-scaling-stroke"
            />
          </a>
        ) : (
          <g class="overlay-link inactive" aria-label={section.label}>
            <rect
              class="overlay-rect"
              x={section.x}
              y={section.y}
              width={section.width}
              height={section.height}
              vector-effect="non-scaling-stroke"
            />
          </g>
        );
      })
    }
  </svg>
</div>

<style>
    .interactive-diagram-container {
    position: relative;
    display: block;
    width: 100%;
    max-width: 100%;
    margin: var(--tnz-space-8) auto;
    }

    .diagram-svg {
    width: 100%;
    height: auto;
    display: block;
    }

    .diagram-image {
    pointer-events: none;
    }

    .overlay-link {
    cursor: pointer;
    }

    .overlay-rect {
    fill: transparent;
    transition: fill var(--tnz-transition-slow);
    }

    .overlay-link:hover .overlay-rect {
    fill: var(--tnz-nav-hover-bg);
    }

    .overlay-link:focus .overlay-rect,
    .overlay-link:focus-visible .overlay-rect {
    stroke: var(--sl-color-text-accent);
    stroke-width: 2;
    }

    .overlay-link.inactive {
    cursor: default;
    pointer-events: none;
    }

    /* Responsive adjustments */
    @media (max-width: 72rem) {
      .interactive-diagram-container {
        margin: var(--tnz-space-6) auto;
      }
    }

    @media (max-width: 50rem) {
      .interactive-diagram-container {
        margin: var(--tnz-space-4) auto;
      }
    }

    /* Accessibility improvements */
    @media (prefers-reduced-motion: reduce) {
      .overlay-area {
        transition: none;
      }
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
      .overlay-area:hover {
        background-color: var(--tnz-nav-active-bg);
        border-color: var(--tnz-neutral-400);
      }
    }
</style>
