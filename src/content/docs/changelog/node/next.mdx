---
title: Next
---

Unreleased changes.

### Features

#### HTTP request body encoding

The `from_http` and `http` operators now support using `record` values for the
request `body` parameter. By default, the record is serialized as JSON. You can
also specify `encode="form"` to send the body as URL-encoded form data. When
using `form` encoding, nested fields are flattened using dot notation (e.g.,
`foo: {bar: "baz"}` => `foo.bar=baz`). This supersedes the `payload` parameter,
which therefore is now deprecated.

###### Examples

By default, setting `body` to a record will JSON-encode it:

```tql
http "https://api.example.com/data", body={foo: "bar", count: 42}
```
```http
POST /data HTTP/1.1
Host: api.example.com
Content-Type: application/json
Content-Length: 33

{
  "foo": "bar",
  "count": 42
}
```

To change the encoding, you can use the `encode` option:

```tql
http "https://api.example.com/data",
  body={foo: {bar: "baz"}, count: 42},
  encode="form"
```
```http
POST /data HTTP/1.1
Host: api.example.com
Content-Type: application/x-www-form-urlencoded
Content-Length: 20

foo.bar=baz&count=42
```

Arbitrary body contents can be sent by using a string or blob:

```tql
http "https://api.example.com/data", body="hello world!"
```
```http
POST /data HTTP/1.1
Host: api.example.com
Content-Length: 12

hello world!
```

By [@raxyte](https://github.com/raxyte) in [#5305](https://github.com/tenzir/tenzir/pull/5305).

### Changes

#### Respecting error responses from Azure Log Analytics

The `to_azure_log_analytics` operator now emits an error when it receives any
response considering an internal error. Those normally indicate configuration
errors and the pipeline will now stop with an error instead of continuing to
send data that will not be received correctly.

By [@tobim](https://github.com/tobim) in [#5314](https://github.com/tenzir/tenzir/pull/5314).

#### `kv` parser no longer produces empty fields

Our Key-Value parsers (the `read_kv` operator and `parse_kv` function) previously
produced empty values if the `value_split` was not found.

With this change, a "field" missing a `value_split` is considered an extension
of the previous fields value instead:

```tql
from \
  {input: "x=1 y=2 z=3 4 5 a=6"},
this = { ...input.parse_kv() }
```
Previous result:
```tql
{x:1, y:2, z:"3", "4":"", "5":"", a:6}
```
New result:
```tql
{x:1, y:2, z:"3 4 5", a:6}
```

By [@IyeOnline](https://github.com/IyeOnline) in [#5313](https://github.com/tenzir/tenzir/pull/5313).

### Bug Fixes

#### Fix `http` operator pagination

The `http` operator dropped all provided HTTP headers after the first request
when performing paginated requests. The operator now preserves the headers for
all requests.

By [@mavam](https://github.com/mavam) in [#5332](https://github.com/tenzir/tenzir/pull/5332).
