---
title: Next
---

Unreleased changes.

### Features

#### Support GOOGLE_CLOUD_PROJECT environment variable in `to_google_cloud_logging` operator

The `to_google_cloud_logging` operator now checks for the `GOOGLE_CLOUD_PROJECT` environment variable
if no explicit project id is given, before falling back to the Google Metadata service.

By [@lava](https://github.com/lava) in [#5591](https://github.com/tenzir/tenzir/pull/5591).

#### Getting Kafka records with `from_kafka`

The new `from_kafka` operator allows you to receive one event per Kafka message,
thus keeping the event boundary unlike `load_kafka`, which has now been
deprecated.

**Example**

Use `from_kafka` to parse JSON events from a topic:

```tql
from_kafka "events"
this = message.parse_json()
```

By [@raxyte](https://github.com/raxyte) in [#5575](https://github.com/tenzir/tenzir/pull/5575).

#### Support for duplicate keys in parsers

Our parsers now have improved support for repeated keys in a an event.
Previously a later key-value pair would always overwrite the previous one.
With this change the value is transparently upgraded to a list of values.

By [@IyeOnline](https://github.com/IyeOnline) in [#5445](https://github.com/tenzir/tenzir/pull/5445).

#### Argument support for User-defined operators

User-defined operators in packages can now declare arguments in their YAML
frontmatter, enabling parameterized operator definitions with the same calling
convention as built-in operators.

Arguments can be positional or named. Both support optional default values and
can be called with literals, constant expressions, or dynamically evaluated
runtime expressions such as fields.

For example, create a reusable operator to set fields dynamically:

```yaml
---
description: "Set a field to a value"
args:
  positional:
    - name: field
      type: field
    - name: value
      type: string
  named:
    - name: prefix
      type: string
      default: ""
---
$field = $prefix + $value
```

Use the operator with both constant and runtime arguments:

```tql
from {x: 1}
mypkg::set_field this.name, "Alice", prefix="User: "
```

```tql
{
  x: 1,
  name: "User: Alice",
}
```

Parameters can be typed with a type name passed in the namesake field. In case
the passed in expression can be evaluated at instantiation time it is checked
against the type and a diagnostic is returned if it does not match. In case a
type check is not possible because the expression contains references to
run-time data, the type check is omitted, and potential errors will be flagged at
runtime. Field-path arguments (declared via `type: field`) accept selectors and
cannot declare defaults.

By [@tobim](https://github.com/tobim).

### Bug Fixes

#### Fixed missing Zeek fields

Zeek JSON contains fields such as `io.data.read.bytes` and
`io.data.read.bytes.per-second`. These fields would previously overwrite each other
in order of appearance.

With this change `bytes` now is a record and the original value is kept under the
key `""`.

By [@IyeOnline](https://github.com/IyeOnline) in [#5445](https://github.com/tenzir/tenzir/pull/5445).

#### Fixed an assertion failure in parsers

We fixed a bug in a common component used across all parsers, which could enter
an inconsistent state, leading to an "unexpected internal error: unreachable".

By [@IyeOnline](https://github.com/IyeOnline) in [#5590](https://github.com/tenzir/tenzir/pull/5590).

#### Removed warning for `void` metrics

The non-actionable warning "received an operator metric without a unit" that was
sometimes emitted for closed subpipelines was removed.

By [@jachris](https://github.com/jachris) in [#5598](https://github.com/tenzir/tenzir/pull/5598).
