# VAST 2020.12.16

Download the release on [GitHub](https://github.com/tenzir/tenzir/releases/tag/2020.12.16).

### Features

[Section titled “Features”](#features)

#### PRs 1196-1233

[Section titled “PRs 1196-1233”](#prs-1196-1233)

The new `dump` command prints configuration and schema-related information. The implementation allows for printing all registered concepts and models, via `vast dump concepts` and `vast dump models`. The flag to `--yaml` to `dump` switches from JSON to YAML output, such that it confirms to the taxonomy configuration syntax.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1196](https://github.com/tenzir/tenzir/pull/1196).

#### Add support for type-level synopses and a string synopsis

[Section titled “Add support for type-level synopses and a string synopsis”](#add-support-for-type-level-synopses-and-a-string-synopsis)

Low-selectivity queries of string (in)equality queries now run up to 30x faster, thanks to more intelligent selection of relevant index partitions.

By [@tobim](https://github.com/tobim) in [#1214](https://github.com/tenzir/tenzir/pull/1214).

#### Add support for USDT tracepoints in VAST

[Section titled “Add support for USDT tracepoints in VAST”](#add-support-for-usdt-tracepoints-in-vast)

On Linux, VAST now contains a set of built-in USDT tracepoints that can be used by tools like `perf` or `bpftrace` when debugging. Initially, we provide the two tracepoints `chunk_make` and `chunk_destroy`, which trigger every time a `vast::chunk` is created or destroyed.

By [@lava](https://github.com/lava) in [#1206](https://github.com/tenzir/tenzir/pull/1206).

#### PRs 1135-1150

[Section titled “PRs 1135-1150”](#prs-1135-1150)

VAST now ships with its own taxonomy and basic concept definitions for Suricata, Zeek, and Sysmon.

By [@mavam](https://github.com/mavam) in [#1135](https://github.com/tenzir/tenzir/pull/1135).

#### Show file size information in lsvast

[Section titled “Show file size information in lsvast”](#show-file-size-information-in-lsvast)

The new option `--print-bytesizes` of `lsvast` prints information about the size of certain fields of the flatbuffers inside a VAST database directory.

By [@lava](https://github.com/lava) in [#1149](https://github.com/tenzir/tenzir/pull/1149).

#### Introduce the #field meta extractor

[Section titled “Introduce the #field meta extractor”](#introduce-the-field-meta-extractor)

The expression language gained support for the `#field` meta extractor. It is the complement for `#type` and uses suffix matching for field names at the layout level.

By [@tobim](https://github.com/tobim) in [#1228](https://github.com/tenzir/tenzir/pull/1228).

#### PRs 1172-1200-1216

[Section titled “PRs 1172-1200-1216”](#prs-1172-1200-1216)

The storage required for index IP addresses has been optimized. This should result in significantly reduced memory usage over time, as well as faster restart times and reduced disk space requirements.

By [@lava](https://github.com/lava) in [#1172](https://github.com/tenzir/tenzir/pull/1172).

#### Allow for enabling client file logging

[Section titled “Allow for enabling client file logging”](#allow-for-enabling-client-file-logging)

The new option `vast.client-log-file` enables client-side logging. By default, VAST only writes log files for the server process.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1132](https://github.com/tenzir/tenzir/pull/1132).

#### Show meta index size in vast status

[Section titled “Show meta index size in vast status”](#show-meta-index-size-in-vast-status)

A new key ‘meta-index-bytes’ appears in the status output generated by `vast status --detailed`.

By [@lava](https://github.com/lava) in [#1193](https://github.com/tenzir/tenzir/pull/1193).

#### PRs 1185-1228

[Section titled “PRs 1185-1228”](#prs-1185-1228)

The query language now supports models. Models combine a list of concepts into a semantic unit that can be fulfiled by an event. If the type of an event contains a field for every concept in a model. Turn to [the documentation](https://vast.io/docs/understand/data-model/taxonomies#models) for more information.

By [@tobim](https://github.com/tobim) in [#1185](https://github.com/tenzir/tenzir/pull/1185).

### Changes

[Section titled “Changes”](#changes)

#### Make Zeek writer work with all data types

[Section titled “Make Zeek writer work with all data types”](#make-zeek-writer-work-with-all-data-types)

The `zeek` export format now strips off the prefix `zeek.` to ensure full compatibility with regular Zeek output. For all non-Zeek types, the prefix remains intact.

By [@mavam](https://github.com/mavam) in [#1205](https://github.com/tenzir/tenzir/pull/1205).

#### Process schema directories recursively

[Section titled “Process schema directories recursively”](#process-schema-directories-recursively)

VAST now processes the schema directory recursively, as opposed to stopping at nested directories.

By [@mavam](https://github.com/mavam) in [#1154](https://github.com/tenzir/tenzir/pull/1154).

#### Make metrics opt-in

[Section titled “Make metrics opt-in”](#make-metrics-opt-in)

VAST does not produce metrics by default any more. The option `--disable-metrics` has been renamed to `--enable-metrics` accordingly.

By [@tobim](https://github.com/tobim) in [#1137](https://github.com/tenzir/tenzir/pull/1137).

#### PRs 1176-1180-1186-1237-satta

[Section titled “PRs 1176-1180-1186-1237-satta”](#prs-1176-1180-1186-1237-satta)

The Suricata schemas received an overhaul: there now exist `vlan` and `in_iface` fields in all types. In addition, VAST ships with new types for `ikev2`, `nfs`, `snmp`, `tftp`, `rdp`, `sip` and `dcerpc`. The `tls` type gets support for the additional `sni` and `session_resumed` fields.

By [@satta](https://github.com/satta) in [#1176](https://github.com/tenzir/tenzir/pull/1176).

#### Move schema definitions into subdirectory

[Section titled “Move schema definitions into subdirectory”](#move-schema-definitions-into-subdirectory)

Installed schema definitions now reside in `<datadir>/vast/schema/types`, taxonomy definitions in `<datadir>/vast/schema/taxonomy`, and concept definitions in `<datadir/vast/schema/concepts`, as opposed to them all being in the schema directory directly. When overriding an existing installation, you *may* have to delete the old schema definitions by hand.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1194](https://github.com/tenzir/tenzir/pull/1194).

#### Set fallback port for underspecified endpoints

[Section titled “Set fallback port for underspecified endpoints”](#set-fallback-port-for-underspecified-endpoints)

VAST now listens on port 42000 instead of letting the operating system choose the port if the option `vast.endpoint` specifies an endpoint without a port. To restore the old behavior, set the port to 0 explicitly.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1170](https://github.com/tenzir/tenzir/pull/1170).

#### Fulfill Deployment Requirements

[Section titled “Fulfill Deployment Requirements”](#fulfill-deployment-requirements)

The build configuration of VAST received a major overhaul. Inclusion of libvast in other procects via `add_subdirectory(path/to/vast)` is now easily possible. The names of all build options were aligned, and the new build summary shows all available options.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1175](https://github.com/tenzir/tenzir/pull/1175).

#### Replace PID file if process does not exist

[Section titled “Replace PID file if process does not exist”](#replace-pid-file-if-process-does-not-exist)

VAST no longer requires you to manually remove a stale PID file from a no-longer running `vast` process. Instead, VAST prints a warning and overwrites the old PID file.

By [@tobim](https://github.com/tobim) in [#1128](https://github.com/tenzir/tenzir/pull/1128).

#### PRs 1143-1157-1160-1165

[Section titled “PRs 1143-1157-1160-1165”](#prs-1143-1157-1160-1165)

The on-disk format for table slices now supports versioning of table slice encodings. This breaking change makes it so that adding further encodings or adding new versions of existing encodings is possible without breaking again in the future.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1143](https://github.com/tenzir/tenzir/pull/1143).

#### Generalize splunk-to-vast

[Section titled “Generalize splunk-to-vast”](#generalize-splunk-to-vast)

The `splunk-to-vast` script has a new name: `taxonomize`. The script now also generates taxonomy declarations for Azure Sentinel.

By [@mavam](https://github.com/mavam) in [#1134](https://github.com/tenzir/tenzir/pull/1134).

#### Remove port type

[Section titled “Remove port type”](#remove-port-type)

The `port` type is no longer a first-class type. The new way to represent transport-layer ports relies on `count` instead. In the schema, VAST ships with a new alias `type port = count` to keep existing schema definitions in tact. However, this is a breaking change because the on-disk format and Arrow data representation changed. Queries with `:port` type extractors no longer work. Similarly, the syntax `53/udp` no longer exists; use `count` syntax `53` instead. Since most `port` occurrences do not carry a known transport-layer type, and the type information exists typically in a separate field, removing `port` as native type streamlines the data model.

By [@mavam](https://github.com/mavam) in [#1187](https://github.com/tenzir/tenzir/pull/1187).

#### Remove Version FlatBuffers table

[Section titled “Remove Version FlatBuffers table”](#remove-version-flatbuffers-table)

Archive segments no longer include an additional, unnecessary version identifier. We took the opportunity to clean this up bundled with the other recent breaking changes.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1168](https://github.com/tenzir/tenzir/pull/1168).

#### Remove CAF-encoded table slices

[Section titled “Remove CAF-encoded table slices”](#remove-caf-encoded-table-slices)

CAF-encoded table slices no longer exist. As such, the option `vast.import.batch-encoding` now only supports `arrow` and `msgpack` as arguments.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1142](https://github.com/tenzir/tenzir/pull/1142).

#### Increase the default segment size to 1 GiB

[Section titled “Increase the default segment size to 1 GiB”](#increase-the-default-segment-size-to-1-gib)

The default segment size in the archive is now 1 GiB. This reduces fragmentation of the archive meta data and speeds up VAST startup time.

By [@mavam](https://github.com/mavam) in [#1166](https://github.com/tenzir/tenzir/pull/1166).

### Bug Fixes

[Section titled “Bug Fixes”](#bug-fixes)

#### Reply to status requests in sinks

[Section titled “Reply to status requests in sinks”](#reply-to-status-requests-in-sinks)

The output of `vast status --detailed` now contains informations about runnings sinks, e.g., `vast export <format> <query>` processes.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1155](https://github.com/tenzir/tenzir/pull/1155).

#### Send correct message to index when dropping further results

[Section titled “Send correct message to index when dropping further results”](#send-correct-message-to-index-when-dropping-further-results)

The index now correctly drops further results when queries finish early, thus improving the performance of queries for a limited number of events.

By [@lava](https://github.com/lava) in [#1209](https://github.com/tenzir/tenzir/pull/1209).

#### Error when specified config file does not exist

[Section titled “Error when specified config file does not exist”](#error-when-specified-config-file-does-not-exist)

VAST no longer starts if the specified config file does not exist.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1147](https://github.com/tenzir/tenzir/pull/1147).

#### Introduce the #field meta extractor

[Section titled “Introduce the #field meta extractor”](#introduce-the-field-meta-extractor-1)

The summary log message of `vast export` now contains the correct number of candidate events.

By [@tobim](https://github.com/tobim) in [#1228](https://github.com/tenzir/tenzir/pull/1228).

#### Fix index worker depletion

[Section titled “Fix index worker depletion”](#fix-index-worker-depletion)

The index no longer causes exporters to deadlock when the meta index produces false positives.

By [@tobim](https://github.com/tobim) in [#1225](https://github.com/tenzir/tenzir/pull/1225).

#### Fix YAML syntax errors in example config

[Section titled “Fix YAML syntax errors in example config”](#fix-yaml-syntax-errors-in-example-config)

The `vast.yaml.example` contained syntax errors. The example config file now works again.

By [@mavam](https://github.com/mavam) in [#1145](https://github.com/tenzir/tenzir/pull/1145).

#### Fix loading and dumping of composed concepts

[Section titled “Fix loading and dumping of composed concepts”](#fix-loading-and-dumping-of-composed-concepts)

Concepts that reference other concepts are now loaded correctly from their definition.

By [@tobim](https://github.com/tobim) in [#1236](https://github.com/tenzir/tenzir/pull/1236).

#### Detect and handle breaking changes in schemas

[Section titled “Detect and handle breaking changes in schemas”](#detect-and-handle-breaking-changes-in-schemas)

The type registry now detects and handles breaking changes in schemas, e.g., when a field type changes or a field is dropped from record.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1195](https://github.com/tenzir/tenzir/pull/1195).

#### Fix a hang when trying to process an invalid query

[Section titled “Fix a hang when trying to process an invalid query”](#fix-a-hang-when-trying-to-process-an-invalid-query)

VAST no longer blocks when an invalid query operation is issued.

By [@tobim](https://github.com/tobim) in [#1189](https://github.com/tenzir/tenzir/pull/1189).

#### Fix a bug that causes sources to stall

[Section titled “Fix a bug that causes sources to stall”](#fix-a-bug-that-causes-sources-to-stall)

`vast import` no longer stalls when it doesn’t receive any data for more than 10 seconds.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1136](https://github.com/tenzir/tenzir/pull/1136).

#### Don’t collect status from sources and sinks

[Section titled “Don’t collect status from sources and sinks”](#dont-collect-status-from-sources-and-sinks)

The `vast status` command does not collect status information from sources and sinks any longer. They were often too busy to respond, leading to a long delay before the command completed.

By [@tobim](https://github.com/tobim) in [#1234](https://github.com/tenzir/tenzir/pull/1234).

#### Switch index behavior when running out of workers

[Section titled “Switch index behavior when running out of workers”](#switch-index-behavior-when-running-out-of-workers)

The index no longer crashes when too many parallel queries are running.

By [@dominiklohmann](https://github.com/dominiklohmann) in [#1210](https://github.com/tenzir/tenzir/pull/1210).