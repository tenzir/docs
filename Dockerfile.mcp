# Use Python 3.13 slim image as base
FROM python:3.13-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    ripgrep \
    git \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy MCP project files from mcp directory
COPY mcp/pyproject.toml mcp/uv.lock mcp/README.md ./
COPY mcp/src/ ./src/

# Install uv and dependencies
RUN pip install uv && \
    uv sync --frozen --no-dev --no-install-project && \
    uv pip install -e .

# Copy documentation content
# The filesystem provider expects content at /src/content
COPY src/content /src/content

# Run as non-root user
RUN useradd -m -u 1000 mcp && chown -R mcp:mcp /app
USER mcp

# MCP servers communicate via stdio
ENTRYPOINT [".venv/bin/python", "-m", "tenzir_docs_mcp.server"]